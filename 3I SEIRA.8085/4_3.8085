	ORG 0800H
	IN 10H
	LXI B,0BBFH		;Αρχικοποίηση καθυστέρησης
	MVI D,30H
	MVI A,FEH		;Θέτω στην 2800Η κατάλληλη τιμή για ανάγνωση
	STA 2800H		;γραμμής που περιέχει το πλήκτρο FETCH PC
	JMP READ_FECH_PC

;Ρουτίνα εισόδου των 4άρων πρώτων ψηφίων
EISODOS:
	CALL KIND
	CPI 10H		;Ελέγχω αν η τιμή είναι από 00 έως 0F βάση του
	JNC EISODOS		;κωδικού που επιστρέφει η KIND και αν είναι
	ANI 0FH		;την καταχωρώ στην αντίστοιχη θέση μνήμης 
	RET			;για την απεικόνισή στα 7-seg

;Ρουτίνα ελέγχου κίνησης
ELEGXOS:
	PUSH PSW		;Σώζω τους καταχωρητές
	PUSH B
	PUSH D

	MVI A,F7H		;Θέτω στην 2800Η κατάλληλη τιμή για ανάγνωση
	STA 2800H		;γραμμής που περιέχει το πλήκτρα "1", "2", "3"
	LDA 1800H
	MVI B,07H
	ANA B
	CPI 06H		;Ελέγχω αν πατήθηκε "1" ή "2" ή "3"
	JZ RET1
	CPI 05H
	JZ RET2
	CPI 03H
	JZ RET3
	MVI A,FEH		;Θέτω στην 2800Η κατάλληλη τιμή για ανάγνωση
	STA 2800H		;γραμμής που περιέχει το πλήκτρο FETCH PC
	LDA 1800H
	MVI B,07H		;Ελέγχω αν πατήθηκε το FECH PC
	ANA B
	CPI 05H
	JZ RET4
	JMP RET5
RET4:				;Ανάλογα το αποτέλεσμα επιστρέφω από τη ρουτίνα
	MVI A,04H		;με μια τιμή στον Β που τον χρησιμοποιώ ως
	STA 0B10H		;σημαία και τον κρατάω στην μνήμη
	JMP RET5
RET3:
	MVI A,03H
	STA 0B10H
	JMP RET5
RET2:
	MVI A,02H
	STA 0B10H
	JMP RET5
RET1:
	MVI A,01H
	STA 0B10H
	JMP RET5
RET5:
	POP D
	POP B
	POP PSW
	RET

;Έλεγχος αν πατήθηκε το πλήκτρο FETCH PC
READ_FECH_PC:
	LDA 1800H
	MVI B,07H		;Ελέγχω αν πατήθηκε το FECH PC
	ANA B
	CPI 05H
	JNZ READ_FECH_PC

;Εμφάνιση οθόνης υποδοχής για την εισαγωγή μηνύματος
OTHONI_YPODOXIS:
	MVI A,00H		;Αρχικοποίηση σημαίας στην μνήμη
	STA 0B10H
	LXI D,0B00H
	MVI A,17H		;Εμφανίζω την οθόνη υποδοχής μηνύματος
	STA 0B00H
	MVI A,17H
	STA 0B01H
	MVI A,17H
	STA 0B02H
	MVI A,17H
	STA 0B03H
	MVI A,10H
	STA 0B04H
	MVI A,10H
	STA 0B05H
	CALL STDM
	CALL DCD
	CALL DELB

	CALL TELEIES
	MVI A,30H		;EMFANISI TELEIWN
	STA 2800H
	MVI A,7FH
	STA 3800H

;Είσοδος μηνήματος
MINIMA:
	LXI D,0B00H		;Ελέγχω κάθε πλήκτρο που πληκτρολογείται και αν
	CALL EISODOS		;είναι επιθυμητό το καταχωρώ στην μνήμη
	STA 0B00H		
	STA 0B12H
	CALL STDM
	CALL DCD
	CALL TELEIES
	MVI A,30H		;EMFANISI TELEIWN
	STA 2800H
	MVI A,7FH
	STA 3800H
	CALL DELB

	CALL EISODOS		;Κρατάω και ένα αντίγραφο του μηνύματος 
	STA 0B01H		;μετατοπισμένο κατα μια θέση σε άλλες θέσεις 
	STA 0B13H		;μνήμης για να το καλέσω όταν θα θέλω κεντραρισμα
	LXI D,0B00H
	CALL STDM
	CALL DCD
	CALL TELEIES
	MVI A,30H		;EMFANISI TELEIWN
	STA 2800H
	MVI A,7FH
	STA 3800H
	CALL DELB

	CALL EISODOS
	STA 0B02H
	STA 0B14H
	LXI D,0B00H
	CALL STDM
	CALL DCD
	CALL TELEIES
	MVI A,30H		;EMFANISI TELEIWN
	STA 2800H
	MVI A,7FH
	STA 3800H
	CALL DELB

	CALL EISODOS
	LXI D,0B00H
	STA 0B03H
	STA 0B15H
	MVI A,10H
	STA 0B04H
	STA 0B16H
	MVI A,10H
	STA 0B05H
	STA 0B11H
	CALL STDM
	CALL DCD
	CALL TELEIES
	MVI A,30H		;EMFANISI TELEIWN
	STA 2800H
	MVI A,7FH
	STA 3800H
	CALL DELB

	;CALL DPS		;Ρουτίνα που μηδενίζει τα πλήκτρα!!!!Σχεδόν!!!
	CALL DELB
	;CALL CODE

;Αναμονή για έναρξη κίνησης
ANAMONI:
	CALL DCD

	CALL ELEGXOS		;Ελέγχω αν πατήθηκε κάποιο από τα επιτρεπτά πλήκτρα

	MVI A,30H		;EMFANISI TELEIWN
	STA 2800H
	MVI A,7FH
	STA 3800H

	LDA 0B10H
	CPI 00H
	JZ ANAMONI
	LDA 0B10H
	CPI 01H
	JZ DEKSIA
	CPI 02H
	JZ ARISTERA
	CPI 03H
	JZ STASIMI
	CPI 04H
	JZ OTHONI_YPODOXIS

;Βρόχος δεξιάς κίνησης 
DEKSIA:
	LXI D,0B00H		;Κάνω δεξιά ολισθήσεις μετάξύ θέσεων μνήμης
	LHLX
	MOV A,L
	INX D
	STAX D
	MOV A,H
	INX D
	LHLX
	STAX D
	MOV A,L
	INX D
	STAX D
	MOV A,H
	INX D
	LHLX
	STAX D
	MOV A,L
	INX D
	STAX D
	MOV A,H
	LXI D,0B00H
	STAX D

	CALL STDM
	CALL DCD

	CALL DELB

	CALL ELEGXOS		;Ελέγχω αν πατήθηκε κάποιο από τα επιτρεπτά πλήκτρα

	MVI D,FFH
	CALL TELEIES
	MOV A,D		;EMFANISI TELEIWN
	STA 2800H
	MOV D,A
	MVI A,7FH
	STA 3800H

	LDA 0B10H
	CPI 01H
	JZ DEKSIA
	CPI 02H
	JZ ARISTERA
	CPI 03H
	JZ STASIMI
	CPI 04H
	JZ OTHONI_YPODOXIS
	JMP DEKSIA

;Βρόχος αριστερής κίνησης
ARISTERA:
	LXI D,0B00H		;Κάνω αριστερά ολισθήσεις μετάξύ θέσεων μνήμης
	LHLX
	MOV A,L
	LXI D,0B05H
	LHLX
	STAX D
	MOV A,L
	DCX D
	LHLX
	STAX D
	MOV A,L
	DCX D
	LHLX
	STAX D
	MOV A,L
	DCX D
	LHLX
	STAX D
	MOV A,L
	DCX D
	LHLX
	STAX D
	MOV A,L
	DCX D
	STAX D
	LXI D,0B00H

	CALL STDM
	CALL DCD

	CALL DELB

	CALL ELEGXOS		;Ελέγχω αν πατήθηκε κάποιο από τα επιτρεπτά πλήκτρα
	CALL TELEIES
	MVI D,FFH
	MOV A,D		;EMFANISI TELEIWN
	STA 2800H
	MOV D,A
	MVI A,7FH
	STA 3800H

	LDA 0B10H
	CPI 01H
	JZ DEKSIA
	CPI 02H
	JZ ARISTERA
	CPI 03H
	JZ STASIMI
	CPI 04H
	JZ OTHONI_YPODOXIS
	JMP ARISTERA

;Το μήνυμα κεντραρισμένο
STASIMI:
	LXI D,0B11H		;Φέρνω το κεντραρισμένο μήνυμα από την μνήμη για 
				;εμφάνιση 
	CALL STDM
	CALL DCD

	CALL ELEGXOS		;Ελέγχω αν πατήθηκε κάποιο από τα επιτρεπτά πλήκτρα
	;CALL TELEIES
	MVI A,21H		;EMFANISI TELEIWN
	STA 2800H
	MVI A,7FH
	STA 3800H

	LDA 0B10H
	CPI 01H
	JZ DEKSIA
	CPI 02H
	JZ ARISTERA
	CPI 03H
	JZ STASIMI
	CPI 04H
	JZ OTHONI_YPODOXIS
	JMP STASIMI

TELEIES:
	PUSH PSW
	PUSH B
BACK:
	PUSH B
LOOPA:
	MVI A,30H		;EMFANISI TELEIWN
	STA 2800H
	MVI A,7FH
	STA 3800H
	CALL DCD
	DCX B
	JNZ LOOPA
	POP B
	MVI A,7FH
	STA 2800H
	LDA 1800H
	CPI FFH
	JZ QUIT
	MVI A,BFH
	STA 2800H
	LDA 1800H
	CPI FFH
	JZ QUIT
	MVI A,DFH
	STA 2800H
	LDA 1800H
	CPI FFH
	JZ QUIT
	MVI A,EFH
	STA 2800H
	LDA 1800H
	CPI FFH
	JZ QUIT
	MVI A,F7H
	STA 2800H
	LDA 1800H
	CPI FFH
	JZ QUIT
	MVI A,FBH
	STA 2800H
	LDA 1800H
	CPI FFH
	JZ QUIT
	JMP BACK
QUIT:
	POP B
	POP PSW
	RET

	END















